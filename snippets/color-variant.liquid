{% assign color_active = false %}
{% for option in product.options %}
  {% if option == 'Color' or option == 'Farbe' %}
    {% assign color_active = true %}
    {% echo 'Found color option: ' | append: option %}
  {% endif %}
{% endfor %}

{% if product.variants.size > 1 and color_active == true %}
  {% for option in product.options %}
      {% if option == 'Color' or option == 'Farbe' %}
      {% assign index = forloop.index0 %}
      {% assign colorlist = '' %}
      {% assign color = '' %}
      {% for variant in product.variants %}
        {% capture color %}
          {{ variant.options[index] }}
        {% endcapture %}
        
        {% echo 'Processing variant: ' | append: color %}
        {% echo 'Inventory: ' | append: variant.inventory_quantity %}
        
        {% if variant.available and variant.inventory_quantity >= 8 %}
          {% unless colorlist contains color %}
            {% assign lowercase_color = color | downcase %}
            {% if lowercase_color contains 'sand' %}
              {% echo 'Found sand color, attempting to render' %}
              {% render 'color-product-card', 
                variant_sel: variant,
                product: product,
                reveal: reveal, 
                hide_product_information: hide_product_information, 
                stacked: true,
                colorname: color,
                tabs2: tabs2
              %}
              
              {% capture tempList %}
                {{colorlist | append: color | append: " " }}
              {% endcapture %}
              {% assign colorlist = tempList %}
            {% else %}
              {% echo 'Color not sand: ' | append: color %}
            {% endif %}
          {% endunless %}
        {% else %}
          {% echo 'Variant not available or inventory less than 8' %}
        {% endif %}
      {% endfor %}
      {% endif %}
  {% endfor %}
{% else %}
  {% echo 'Not processing variants: either only one variant or color not active' %}
  {% render 'product-card',
    product: product,
    reveal: reveal, 
    hide_product_information: hide_product_information,
    stacked: true
  %}
{% endif %}